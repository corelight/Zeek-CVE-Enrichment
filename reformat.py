#!/usr/bin/env python3
import csv
import sys
from collections import defaultdict

def reformat(input_file, output_file):
    reader = csv.reader(input_file)
    hosts = defaultdict(set)
    for ip, hostname, cve in reader:
        hosts[ip,hostname].add(cve)

    output_file.write("#fields\tip\thostname\tcve_list\n")
    for (ip, hostname), cves in hosts.items():
        cve_list=','.join(sorted(cves))
        output_file.write("\t".join([ip, hostname, cve_list]) + "\n")

def main():
    input_filename = sys.argv[1]
    output_filename = sys.argv[2]
    with open(input_filename, 'r') as i:
        with open(output_filename, 'w') as o:
            reformat(i, o)

if __name__ == "__main__":
    main()
